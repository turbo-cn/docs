---
title: Turborepo Codemods
description: 为了使升级更容易，Turborepo包括代码代码和迁移脚本。
---

# Turborepo Codemods

Turborepo提供Codemod转换和自动迁移脚本，以帮助在某个特性被弃用时升级您的Turborepo代码库。

Codemods是以编程方式在代码库上运行的转换。 这允许应用大量的更改，而不必手动遍历每个文件。
## Usage

```sh
npx @turbo/codemod <transform> <path>
```

- ' transform ' -变换的名称，参见下面可用的变换。
- ' path ' -要转换的文件或目录
- '——dry ' -做一个演练，没有代码将被编辑
- '——print ' -打印更改后的输出进行比较

## Turborepo 1.x

### `add-package-manager`


将根 `package.json` 以便 ' packageManager '键作为检测到的包管理器(' yarn '， ' npm '， ' pnpm ')和版本(例如: “yarn@1.22.17”)。 这个键现在[由Node.js支持](https://nodejs.org/dist/latest-v17.x/docs/api/packages.html#packagemanager)，并且被Turborepo用于更快的包管理器检测(相对于仅从文件系统推断)。

例如，对于Yarn v1:


```json
// Before
{
  "name": "turborepo-basic",
  "version": "0.0.0",
  "private": true,
  "workspaces": ["apps/*", "packages/*"]
  // ...
}
```

```diff
{
  "name": "turborepo-basic",
  "version": "0.0.0",
  "private": true,
+  "packageManager": "yarn@1.22.17",
  "workspaces": [
    "apps/*",
    "packages/*"
  ]
}
```

#### Usage

进入你的项目:

```sh
cd path-to-your-turborepo/
```

Run the codemod:

```sh
npx @turbo/codemod add-package-manager
```

### `create-turbo-config`

Creates the `turbo.json` file at the root of your project based on the `"turbo"` key in `package.json`.
The `"turbo"` key is subsequently deleted from `package.json`.

创建 `turbo.json`的项目根目录下的`"turbo"`键入' package.json '中的。
' "turbo"键随后从' package.json '中删除。

例如:

```json
// Before, package.json
{
  "name": "Monorepo root",
  "private": true,
  "turbo": {
    "pipeline": {
      ...
    }
  },
  ...
}
```

```diff
// After, package.json
{
  "name": "Monorepo root",
  "private": true,
-  "turbo": {
-    "pipeline": {
-      ...
-    }
-  },
  ...
}

// After, turbo.json
+{
+  "$schema": "https://turborepo.org/schema.json",
+  "pipeline": {
+    ...
+  }
+}
```

#### Usage

回到你的项目:

```sh
cd path-to-your-turborepo/
```

Run the codemod:

```sh
npx @turbo/codemod create-turbo-config
```

### `migrate-env-var-dependencies`

在‘turbo’中迁移所有环境变量依赖项。 从' dependsOn '和' globalDependencies '改为' env '和' globalEnv '。
For example:

```json
// Before, turbo.json
{
  "$schema": "https://turborepo.org/schema.json",
  "globalDependencies": [".env", "$CI_ENV"],
  "pipeline": {
    "build": {
      "dependsOn": ["^build", "$API_BASE"],
      "outputs": [".next/**"]
    },
    "lint": {
      "outputs": []
    },
    "dev": {
      "cache": false
    }
  }
}
```

````diff
// After, turbo.json
{
  "$schema": "https://turborepo.org/schema.json",
- "globalDependencies": [".env", "$CI_ENV"],
+ "globalDependencies": [".env"],
+ "globalEnv": ["CI_ENV"],
  "pipeline": {
    "build": {
-     "dependsOn": ["^build", "$API_BASE"],
+     "dependsOn": ["^build"],
+     "env": ["API_BASE"],
      "outputs": [".next/**"],
    },
    "lint": {
      "outputs": []
    },
    "dev": {
      "cache": false
    }
  }
}

#### Usage

Go to your project:

```sh
cd path-to-your-turborepo/
````

Run the codemod:

```sh
npx @turbo/codemod migrate-env-var-dependencies
```
